import { Product } from './product.js';
export class Book extends Product {
    constructor(name, genre, price, author, reviews) {
        super();
        this.name = name;
        this.genre = genre;
        this.price = price;
        this.author = author;
        if (reviews) {
            this.reviews = reviews;
        }
        else {
            this.reviews = null;
        }
        this.calculateRating();
    }
    getProductDescription() {
        return `Book "${this.name}" by ${this.author.firstName} ${this.author.lastName}`;
    }
    addReview(review) {
        this.reviews.push(review);
        this.calculateRating();
    }
    removeReview(review) {
        const index = this.reviews.indexOf(review);
        if (index > -1) {
            this.reviews.splice(index, 1);
            this.calculateRating();
        }
    }
    get rating() {
        return this._rating;
    }
    getRreviews() {
        return this.reviews;
    }
    calculateRating() {
        if (this.reviews.length > 0) {
            const reviewSum = this.reviews.reduce((acc, curr) => acc + curr[1], 0);
            this._rating = reviewSum / this.reviews.length;
        }
        else {
            this._rating = null;
        }
    }
    calculateDiscount(context) {
        const { cart: { items, totalSum }, user: { clientLevel } } = context !== null && context !== void 0 ? context : {};
        if (items >= 3 && totalSum >= 3000) {
            return this.price * 35 / 100;
        }
        else {
            return this.price * (clientLevel * 10) / 100;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm9vay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ib29rLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVNBLE9BQU8sRUFBQyxPQUFPLEVBQUMsTUFBTSxjQUFjLENBQUM7QUFHckMsTUFBTSxPQUFPLElBQUssU0FBUSxPQUFPO0lBUS9CLFlBQ0UsSUFBWSxFQUNaLEtBQVksRUFDWixLQUFhLEVBQ2IsTUFBa0IsRUFDbEIsT0FBbUI7UUFFbkIsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUVyQixJQUFJLE9BQU8sRUFBRTtZQUNYLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1NBQ3hCO2FBQU07WUFDTCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztTQUNyQjtRQUVELElBQUksQ0FBQyxlQUFlLEVBQUcsQ0FBQztJQUMxQixDQUFDO0lBRUQscUJBQXFCO1FBQ25CLE9BQU8sU0FBUyxJQUFJLENBQUMsSUFBSSxRQUFRLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDbkYsQ0FBQztJQUVELFNBQVMsQ0FBRSxNQUFlO1FBQ3hCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFCLElBQUksQ0FBQyxlQUFlLEVBQUcsQ0FBQztJQUMxQixDQUFDO0lBRUQsWUFBWSxDQUFFLE1BQWU7UUFDM0IsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFM0MsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEVBQUU7WUFDZCxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDOUIsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1NBQ3hCO0lBQ0gsQ0FBQztJQUVELElBQUksTUFBTTtRQUNSLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUN0QixDQUFDO0lBRUQsV0FBVztRQUNULE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUN0QixDQUFDO0lBRU8sZUFBZTtRQUNyQixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUMzQixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFdkUsSUFBSSxDQUFDLE9BQU8sR0FBRyxTQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7U0FDaEQ7YUFBTTtZQUNMLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1NBQ3JCO0lBQ0gsQ0FBQztJQUVTLGlCQUFpQixDQUFDLE9BQXlCO1FBQ25ELE1BQU0sRUFBQyxJQUFJLEVBQUUsRUFBQyxLQUFLLEVBQUUsUUFBUSxFQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUMsV0FBVyxFQUFDLEVBQUMsR0FBRyxPQUFPLGFBQVAsT0FBTyxjQUFQLE9BQU8sR0FBSSxFQUFFLENBQUM7UUFFckUsSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJLFFBQVEsSUFBSSxJQUFJLEVBQUU7WUFDbEMsT0FBTyxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUM7U0FDOUI7YUFBTTtZQUNMLE9BQU8sSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLFdBQVcsR0FBRyxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUM7U0FDOUM7SUFDSCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIEJvb2tBdXRob3IsXHJcbiAgR2VucmUsXHJcbiAgSUF1dGhvcixcclxuICBJQm9vayxcclxuICBJUHJvZHVjdCxcclxuICBJUmF0aW5nYWJsZSxcclxuICBUUmV2aWV3XHJcbn0gZnJvbSAnLi9tb2RlbHMuanMnO1xyXG5pbXBvcnQge1Byb2R1Y3R9IGZyb20gJy4vcHJvZHVjdC5qcyc7XHJcbmltcG9ydCB7IElQdXJjaGFzZUNvbnRleHQgfSBmcm9tICcuL3B1cmNoYXNlLWNvbnRleHQuanMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIEJvb2sgZXh0ZW5kcyBQcm9kdWN0IGltcGxlbWVudHMgSVJhdGluZ2FibGUge1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBnZW5yZTogR2VucmU7XHJcbiAgcHJpY2U6IG51bWJlcjtcclxuICBhdXRob3I6IEJvb2tBdXRob3I7XHJcbiAgcHJpdmF0ZSBfcmF0aW5nOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSByZXZpZXdzOiBUUmV2aWV3W107XHJcbiAgICBcclxuICBjb25zdHJ1Y3RvciAoXHJcbiAgICBuYW1lOiBzdHJpbmcsXHJcbiAgICBnZW5yZTogR2VucmUsXHJcbiAgICBwcmljZTogbnVtYmVyLFxyXG4gICAgYXV0aG9yOiBCb29rQXV0aG9yLFxyXG4gICAgcmV2aWV3cz86IFRSZXZpZXdbXSxcclxuICApIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgdGhpcy5nZW5yZSA9IGdlbnJlO1xyXG4gICAgdGhpcy5wcmljZSA9IHByaWNlO1xyXG4gICAgdGhpcy5hdXRob3IgPSBhdXRob3I7XHJcblxyXG4gICAgaWYgKHJldmlld3MpIHtcclxuICAgICAgdGhpcy5yZXZpZXdzID0gcmV2aWV3cztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMucmV2aWV3cyA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jYWxjdWxhdGVSYXRpbmcgKCk7XHJcbiAgfVxyXG5cclxuICBnZXRQcm9kdWN0RGVzY3JpcHRpb24gKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gYEJvb2sgXCIke3RoaXMubmFtZX1cIiBieSAke3RoaXMuYXV0aG9yLmZpcnN0TmFtZX0gJHt0aGlzLmF1dGhvci5sYXN0TmFtZX1gO1xyXG4gIH1cclxuXHJcbiAgYWRkUmV2aWV3IChyZXZpZXc6IFRSZXZpZXcpOiB2b2lkIHtcclxuICAgIHRoaXMucmV2aWV3cy5wdXNoKHJldmlldyk7XHJcbiAgICB0aGlzLmNhbGN1bGF0ZVJhdGluZyAoKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZVJldmlldyAocmV2aWV3OiBUUmV2aWV3KTogdm9pZCB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMucmV2aWV3cy5pbmRleE9mKHJldmlldyk7XHJcblxyXG4gICAgaWYgKGluZGV4ID4gLTEpIHtcclxuICAgICAgdGhpcy5yZXZpZXdzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgIHRoaXMuY2FsY3VsYXRlUmF0aW5nKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXQgcmF0aW5nICgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JhdGluZztcclxuICB9XHJcblxyXG4gIGdldFJyZXZpZXdzICgpOiBSZWFkb25seTxUUmV2aWV3W10+IHtcclxuICAgIHJldHVybiB0aGlzLnJldmlld3M7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNhbGN1bGF0ZVJhdGluZyAoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5yZXZpZXdzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgcmV2aWV3U3VtID0gdGhpcy5yZXZpZXdzLnJlZHVjZSgoYWNjLCBjdXJyKSA9PiBhY2MgKyBjdXJyWzFdLCAwKTtcclxuXHJcbiAgICAgIHRoaXMuX3JhdGluZyA9IHJldmlld1N1bSAvIHRoaXMucmV2aWV3cy5sZW5ndGg7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9yYXRpbmcgPSBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGNhbGN1bGF0ZURpc2NvdW50KGNvbnRleHQ6IElQdXJjaGFzZUNvbnRleHQpOiBudW1iZXIge1xyXG4gICAgY29uc3Qge2NhcnQ6IHtpdGVtcywgdG90YWxTdW19LCB1c2VyOiB7Y2xpZW50TGV2ZWx9fSA9IGNvbnRleHQgPz8ge307XHJcblxyXG4gICAgaWYgKGl0ZW1zID49IDMgJiYgdG90YWxTdW0gPj0gMzAwMCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5wcmljZSAqIDM1IC8gMTAwO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMucHJpY2UgKiAoY2xpZW50TGV2ZWwgKiAxMCkgLyAxMDA7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==